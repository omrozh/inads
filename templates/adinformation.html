<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>InAds - Dashboard</title>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,300" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="/styles">
</head>
<body style="font-family: open sans; margin: 0;">
    <div style="min-height: 100vh; background-color: rgba(150, 238, 229, 0.05); width: 20%; border-right:1px solid rgba(150, 150, 150, .5); float: left; position: fixed">
        <div style="color: black; margin-left: 25%;">
            <br>
            <div style="font-size: 80%">{{ user.email }}</div>
            <a href="/dashboard" style="margin-top: 30%" class="navbarElement">Dashboard</a>
            <br>
            <a style="margin-top: 10%" href="/advertise" class="navbarElement">Start a campaign</a>
            <br>
            <a style="margin-top: 10%" href="/load_money" class="navbarElement">Increase Account Balance</a>
            <br>
            <a style="margin-top: 10%" href="/account" class="navbarElement">Account</a>
            <br>
            {% if user.purpose == "Content Creator" %}
            <a style="margin-top: 10%" href="/add_domain" class="navbarElement">Add Domain</a>
            <br>
            <a style="margin-top: 10%" href="/payout" class="navbarElement">Receive Payout</a>
            <br>
            <a style="margin-top: 10%" href="/website_performance" class="navbarElement">Website Performance</a>
            <br>
            {% if is_admin %}
                <a style="margin-top: 10%" href="/web_traffic" class="navbarElement">View Website Traffic</a>
                <br>
                <div class="navbarElement" style="font-size: 80%; margin-top: 10%"> Admin </div>
            {% endif %}
            {% endif %}
            {% if user.is_partner %}
                <div class="navbarElement" style="font-size: 80%; margin-top: 10%">Advertising Partner</div>
            {% endif %}
        </div>
    </div>
    <div style="float: left; width: 79%; margin-left: 20%">
        <h1 style="margin-left: 5%">Ad Information</h1>
            <div id="chartContainer" style="height: 300px; width: 100%;"></div>
            <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
            <button style="margin-left: 10%; width: 80%" class="accordion">{{ ads.advertiserwebsite }}</button>
            <div style="margin-left: 10%" class="panel">
                <div>
                    <h3>{{ ads.advertiserwebsite }}</h3>
                    <h3>{{ ads.keywords }}</h3>
                    <h3>Total number of ad clicks: {{ ads.total_clicks }}</h3>
                    <h3>Total number of view: {{ ads.total_views }}</h3>
                    <h3>Remaining Budget: {{ "%.2f" % ads.budget }} $</h3>
                    <h3>Ad Type: {{ ads.ad_type }}</h3>
                    <h3>Advertising websites: </h3>
                    <p>
                        {% for i in unique_publishers %}
                             {{ i }}  : {{ publishers.count(i) }}
                            <br>
                        {% endfor %}
                    </p>
                    <h3>Advertising clicks: </h3>
                    <p>
                        {% for i in unique_publishers_clicks %}
                            {{ i }} : {{ publishers_clicks.count(i) }}
                            <br>
                        {% endfor %}
                    </p>
                    <form method="post">
                        <input class="mainFormBig" style="width: 100%" type=text name=keywords placeholder="Change keywords (Keywords with '/' in between.)">
                        <hr>
                        <br>
                        <input class="buttonBlue" style="width: 40%" type=submit value="Change Keywords">
                        <br>
                        <br>
                        <br>
                        <input class="mainFormBig" style="width: 100%" type=text name=bannedwebsites placeholder="Blacklisted Websites for this ad: (Websites with '/' in between.)">
                        <hr>
                        <br>
                        <input class="buttonBlue" style="width: 40%" type=submit value="Send Blacklist Request">
                    </form>
                    {% if numberofads < 5 %}
                        <small>You are using too few keywords this may result in a high rate of inconsistency
                            and inaccuracy with targeted ads.</small>
                    {% endif %}
                    <h3>Average CPM: {{ average_cpm }}</h3>
                    <h3>Average CPC: {{ average_cpc }}</h3>
                    <h3>Total Spending: {{ total_spending }}</h3>
                    <h3>Ad Click Rate: 1 / {{ click_rate }}</h3>
                    <h3>Average CPM for similar keywords: {{ average_cpm_of_keywords }}</h3>
                    {% if paused %}
                        <a href="/unpause/{{ ads.id }}" style="text-decoration=none; color: gray">Unpause ad</a>
                    {% elif not paused %}
                        <a href="/pause/{{ ads.id }}" style="text-decoration=none; color: gray">Pause ad</a>
                    {% endif %}
                </div>
            </div>
        <br>
    </div>
    <script>
    window.onload = function () {

    var chart = new CanvasJS.Chart("chartContainer", {
        animationEnabled: true,

        title:{
            text:"Average CPM for similar keywords | This Campaign's CPM"
        },
        axisX:{
            interval: 1
        },
        axisY2:{
            interlacedColor: "rgba(1,77,101,.2)",
            gridColor: "rgba(1,77,101,.1)",
            title: "CPM"
        },
        data: [{
            type: "bar",
            name: "cpm",
            axisYType: "secondary",
            color: "#014D65",
            dataPoints: [
                { y: {{ average_cpm_of_keywords }} , label: "Similar Keywords" },
                { y: {{ average_cpm }}, label: "This Ad" },
            ]
        }]
    });
    chart.render();

    }
        var acc = document.getElementsByClassName("accordion");
        var i;

        for (i = 0; i < acc.length; i++) {
          acc[i].addEventListener("click", function() {
            this.classList.toggle("active");

            var panel = this.nextElementSibling;
            if (panel.style.display === "block") {
              panel.style.display = "none";
            } else {
              panel.style.display = "block";
            }
          });
        }
    </script>
</body>
</html>